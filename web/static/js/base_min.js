var arduino_check_connect_sec=300,arduino_check_broken_connect_sec=60,branch=[];$(document).ready(function(){$(".add_rule").on("click",function(){$.ajax({url:"/branch_settings",success:function(t){list=t.list,$("#branch_select_plann_modal").find("option").remove();for(j in list)item=list[j],branch[item.id]={name:item.name,default_time:parseInt(item.default_time),default_interval:parseInt(item.default_interval),default_time_wait:parseInt(item.default_time_wait),start_time:new Date(item.start_time)},$("#branch_select_plann_modal").append("<option value="+item.id+">"+item.name+"</option>");var a=$("#plann_modal"),e=convert_date(new Date);$(a).find($(".irrigation_date_plann_modal")).val(e),set_branch_defaults(parseInt($("#branch_select_plann_modal option:selected").val()),a),$("#plann_modal").modal("show")}})}),$("#branch_select_plann_modal").off().on("change",function(t){modal=$("#plann_modal"),set_branch_defaults(parseInt($(this).val()),modal)}),$("#irrigation_intervals_plann_modal").on("input",function(t){modal=$("#plann_modal");var a=parseInt($(this).val());a<=1||isNaN(a)?$(modal).find("#irrigation_time_wait_group").hide():$(modal).find("#irrigation_time_wait_group").css("display","inline-block")}),$(".plan").click(function(){var t={list:{}},a=$(this).closest("#plann_modal");branch_id=$(a).find("#branch_select_plann_modal option:selected").val(),time=$(a).find("#irrigation_minutes_plann_modal").val(),interval=$(a).find("#irrigation_intervals_plann_modal").val(),time_wait=$(a).find("#irrigation_time_wait_plann_modal").val(),date_start=$(a).find(".irrigation_date_plann_modal").val(),time_start=$(a).find(".irrigation_time_plann_modal").val(),t.list[branch_id]={branch_id:branch_id,time:time,interval:interval,time_wait:time_wait,datetime_start:date_start+" "+time_start},$.ajax({url:"/add_rule",type:"post",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(t,a){set_status_spinner()},success:function(){set_status_ok(),$("#plann_modal").modal("hide")},error:function(){alert("error"),set_status_ok()}})}),function t(){$.ajax({url:"/weather",success:function(a){$("#temp").text(a.temperature),$("#hum").text(a.humidity),$("#rain").text(a.rain),1==a.rain_status?$("#irrigation_status").text("Автоматичний полив дозволений"):$("#irrigation_status").text("Автоматичний полив заборонений"),setTimeout(t,18e5)}})}();$.each(["drawer-f-l","drawer-f-r","drawer-f-t","drawer-f-b"],function(t,a){$("#"+a).click(function(){setDrawerPosition("bmd-"+a)})}),$("#drawer-visibility").click(function(){var t=$(".bmd-layout-container"),a=$(this),e=a.find(".material-icons");"visibility"==e.text()?(t.addClass("bmd-drawer-out"),e.text("visibility_off"),a.attr("title","Drawer allow responsive opening")):(t.removeClass("bmd-drawer-out"),e.text("visibility"),a.attr("title","Drawer force closed"))})});var class_ok={msg:" Система активна",class:"fa fa-refresh"},class_spin={msg:" Перевірка статусу системи...",class:"fa fa-refresh fa-spin"},class_err={msg:" В системі помилка",class:"status-error"};function set_status_error(){$(".card-irrigation").addClass(class_err.class),$(".card-lighting").addClass(class_err.class),$(".btn-open-modal").addClass("disabled"),$(".btn-start").addClass("disabled"),$(".status-span").css("display","inline-block")}function set_status_ok(){$(".card-irrigation").removeClass(class_err.class),$(".card-lighting").removeClass(class_err.class),$(".btn-open-modal").removeClass("disabled"),$(".btn-start").removeClass("disabled"),$(".stop-lighting").removeClass("disabled"),$(".stop-power_outlet").removeClass("disabled"),$(".stop-irrigation").removeClass("disabled"),$(".status-span").hide(),$(".btn-open-modal").show(),$(".btn-modal").removeClass("disabled")}function set_status_spinner(){$(".btn-open-modal").addClass("disabled"),$(".btn-start").addClass("disabled"),$(".stop-lighting").addClass("disabled"),$(".stop-power_outlet").addClass("disabled"),$(".stop-irrigation").addClass("disabled"),$(".btn-modal").addClass("disabled")}function clearDrawerClasses(t){$.each(["bmd-drawer-f-l","bmd-drawer-f-r","bmd-drawer-f-t","bmd-drawer-f-b"],function(a,e){t.removeClass(e)})}function setDrawerPosition(t){var a=$(".bmd-layout-container");clearDrawerClasses(a),a.addClass(t)}function convert_date_to_time(t){return t instanceof Date==0&&(t=new Date(t)),("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)}function convert_date_to_time_utc(t){return t instanceof Date==0&&(t=new Date(t)),("0"+(t=convertDateToUTC(t)).getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)}function convert_date(t){t instanceof Date==0&&(t=new Date(t));var a=("0"+t.getDate()).slice(-2),e=("0"+(t.getMonth()+1)).slice(-2);return t.getFullYear()+"-"+e+"-"+a}function convert_date_to_local_date(t){var a=new Date;a.setDate(a.getDate()+parseInt(t));var e=("0"+a.getDate()).slice(-2),i=("0"+(a.getMonth()+1)).slice(-2);return a.getFullYear()+"-"+i+"-"+e}function get_parameter_by_name(t,a){a||(a=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var e=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(a);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function daydiff(t,a){return date1=new Date(t.getFullYear(),t.getMonth(),t.getDate()),date2=new Date(a.getFullYear(),a.getMonth(),a.getDate()),Math.ceil((date2-date1)/864e5)}function convertDateToUTC(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function toogle_time_wait(t,a){var e=parseInt(t);void 0==a?e<=1||isNaN(e)?$("#irrigation_time_wait_group").hide():$("#irrigation_time_wait_group").show():e<=1||isNaN(e)?$(a).find("#irrigation_time_wait_group").hide():$(a).find("#irrigation_time_wait_group").show()}function set_branch_defaults(t,a){branch[t].name;var e=branch[t].default_time,i=branch[t].default_interval,n=branch[t].default_time_wait,r=branch[t].start_time;void 0!=a?($(a).find("#irrigation_minutes_plann_modal").val(e),$(a).find("#irrigation_intervals_plann_modal").val(i),$(a).find("#irrigation_time_wait_plann_modal").val(n),$(a).find(".irrigation_time_plann_modal").val(convert_date_to_time(r))):($("#irrigation_minutes").val(e),$("#irrigation_intervals").val(i),$("#irrigation_time_wait").val(n),$(".irrigation_time").val(convert_date_to_time(r))),toogle_time_wait(i,a)}